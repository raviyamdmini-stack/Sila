const axios = require('axios');
const config = require('../config');
const { applyFont } = require('../lib/fonts');

module.exports = async (sock, sender, args, msg, { safeSendMessage, sendReaction }) => {
    if (!args.length) {
        await safeSendMessage(sender, { 
            text: applyFont('âŒ *Please provide prompt!*\nExample: .flux beautiful landscape') 
        });
        return;
    }
    
    const prompt = args.join(' ');
    
    try {
        await sendReaction(msg, 'ğŸ¨');
        await safeSendMessage(sender, { text: applyFont('ğŸ¨ *Generating AI image...*') });
        
        const response = await axios.get(`https://api.bk9.dev/ai/fluximg?q=${encodeURIComponent(prompt)}`, {
            timeout: 30000
        });
        
        if (response.data.status && response.data.result) {
            await safeSendMessage(sender, {
                image: { url: response.data.result },
                caption: applyFont(`*â•­â”â”â”ã€” ğŸ¢ ğ™°ğ™¸ ğ™¸ğ™¼ğ™°ğ™¶ğ™´ ğŸ¢ ã€•â”â”â”â”ˆâŠ·*
*â”ƒğŸ¢â”‚ ğ™¿ğšğ™¾ğ™¼ğ™¿ğšƒ :â¯ ${prompt}*
*â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·*

ğŸ¨ *Generated by Sila MD*`)
            });
            await sendReaction(msg, 'âœ¨');
        } else {
            await safeSendMessage(sender, { 
                text: applyFont('âŒ *Failed to generate image!*\nPlease try another prompt.') 
            });
        }
    } catch (error) {
        await safeSendMessage(sender, { 
            text: applyFont('âŒ *AI service error!*\nPlease try again later.') 
        });
    }
};